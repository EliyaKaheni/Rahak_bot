import csv
import telebot
from telebot import types

BOT_ID = 'Boom-Boom'
bot = telbot.Telebot(BOT_ID)

# Users temp database
users = {}

# Error handler
def error(message):
    bot.send_message(message.chat.id, "Ø¨Ø¨Ø®Ø´ÛŒØ¯ ÙÚ©Ø± Ú©Ù†Ù… ÛŒÙ‡ Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ Ù¾ÛŒØ´ Ø§ÙˆÙ…Ø¯Ù‡ ğŸ¤¦\n Ù„Ø·ÙØ§ Ø±Ø¨Ø§Øª Ø±Ùˆ Ù…Ø¬Ø¯Ø¯Ø§ Ø§Ø³ØªØ§Ø±Øª Ú©Ù† Ùˆ Ø§Ø² Ø§ÙˆÙ„ Ù…Ø±Ø§Ø­Ù„ Ø±Ùˆ Ø·ÛŒ Ú©Ù†. Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ù‡Ù… Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ† ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±.")


""" DATABASE MANAGEMENT """
def Read_DataBase():
    try:
        with open('users.csv', mode='r') as infile:
            reader = csv.reader(infile)
            temp = {rows[0]:[rows[1], rows[2], rows[3]] for rows in reader}

        print(temp)
        return temp
    except:
        print('Please check the database')

def Write_DataBase(users):
    try:
        field_names = ['ID', 'Name', 'Book', 'League']

        with open('users.csv', 'w') as csvfile:
            writer = csv.DictWriter(csvfile, fieldnames = field_names)
            writer.writeheader()
            writer.writerows(users)

    except:
        print('Please check the database')


""" MENUS """
def start_menu(message):
    try:
        markup = types.ReplyKeyboardMarkup(row_width=1)
        item = types.KeyboardButton('Ø¨Ø±ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ø§Ù… âœ…')
        markup.add(item)
        bot.send_message(message.chat.id, 'Ø¨Ø±ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ø§Ù…ØŸ', reply_markup=markup)

    except:
        error(message)

def league_menu(message):
    try:
        markup = types.ReplyKeyboardMarkup(row_width=1)
        item1 = types.KeyboardButton('Ù„ÛŒÚ¯ 1')
        item2 = types.KeyboardButton('Ù„ÛŒÚ¯ 2')
        item3 = types.KeyboardButton('Ù„ÛŒÚ¯ 3')
        markup.add(item1, item2, item3)
        bot.send_message(message.chat.id, 'Ù„ÛŒÚ¯ Ù†Ù…Ø§ÛŒØ§Ù†Ú¯Ø± Ú¯Ø±ÙˆÙ‡ÛŒ Ø§Ø² Ø¯ÙˆØ³ØªØ§Ù† Ø´Ù…Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§Ù‡Ù… ', reply_markup=markup)

    except:
        error(message)



# Start handler
@bot.message_handler(commands=['start'])
def handle_start(message):
    try:
        # Saving the user
        global users
        users[message.chat.id] = {}

        #Setting the menu
        start_menu(message)

    except:
        error(message)

# Sign-up section
@bot.message_handler(func=lambda msessage: message.text=='Ø¨Ø±ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ø§Ù… âœ…')
def signup_1(message):
    try:
        bot.send_message('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯')
        bot.register_next_step_handler(message, signup_2)

    except:
        error(message)

def signup_2(message):
    try:
        global users
        name = message.text
        users[message.chat.id]['Name'] = name

        bot.send_message('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ú©ØªØ§Ø¨ÛŒ Ú©Ù‡ Ù…ÛŒ Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø¢Ù†Ø±Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.')
        bot.register_next_step_handler(message, signup_3)

    except:
        error(message)

def signup_3(message):
    try:
        global users
        book = message.text
        users[message.chat.id]['Book'] = book

        bot.send_message('Ù„Ø·ÙØ§ Ù„ÛŒÚ¯ÛŒ Ú©Ù‡ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ø¢Ù† Ù‡Ø³ØªÛŒØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.')

        bot.register_next_step_handler(message, signup_4)

    except:
        error(message)

def signup_4(message):
    try:
        global users
        name = message.text
        users[message.chat.id]['League'] = name

        bot.send_message('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ú©ØªØ§Ø¨ÛŒ Ú©Ù‡ Ù…ÛŒ Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø¢Ù†Ø±Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.')
        bot.register_next_step_handler(message, signup_3)

    except:
        error(message)

